branches:
  only:
    - release

language: java

jdk: openjdk11

services:
  - docker

install:
  - docker build -t dhavelock/segments-explorer:$TRAVIS_BUILD_NUMBER .
  - ./mvnw clean install
  - npm install -g snyk
  - snyk test
  - snyk code test
  - snyk container test dhavelock/segments-explorer:$TRAVIS_BUILD_NUMBER

deploy:
  provider: script
  script: echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin; docker push dhavelock/segments-explorer:$TRAVIS_BUILD_NUMBER
  on:
    branch: release

after_deploy:
  - snyk monitor